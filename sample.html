<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF8">
    <title>Title</title>
    <script src="https://unpkg.com/js-image-zoom@0.4.1/js-image-zoom.js" type="application/javascript"></script>
</head>
<body>
    <div  style="width: 400px" id="img-container" >
        <img src="https://www.filmibeat.com/ph-big/2020/01/mammootty_1579675009210.jpg" />
    <div>
<script>
var options = {
    width: 400,
    zoomWidth: 500,
    offset: {vertical: 0, horizontal: 10}
};
new ImageZoom(document.getElementById("img-container"), options);
 
</script>
</body>
</html>

<!--email otp Send 
const nodemailer = require('nodemailer');
const otpGenerator = require('otp-generator');

const transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: 'your_email@gmail.com',
    pass: 'your_email_password'
  }
});

const otp = otpGenerator.generate(6, { digits: true, alphabets: false, upperCase: false, specialChars: false });

const mailOptions = {
  from: 'your_email@gmail.com',
  to: 'recipient_email@gmail.com',
  subject: 'Your OTP',
  text: `Your OTP is ${otp}.`
};

transporter.sendMail(mailOptions, (error, info) => {
  if (error) {
    console.error(error);
  } else {
    console.log(`Email sent: ${info.response}`);
  }
});
-->

fetchapi
// Function to block a product
async function blockProduct(productId) {
  try {
    const response = await fetch(`/api/products/${productId}/block`, {
      method: 'POST'
    });
    const data = await response.json();
    console.log(data); // Output: { success: true }
  } catch (error) {
    console.error(error);
  }
}

// Function to unblock a product
async function unblockProduct(productId) {
  try {
    const response = await fetch(`/api/products/${productId}/unblock`, {
      method: 'POST'
    });
    const data = await response.json();
    console.log(data); // Output: { success: true }
  } catch (error) {
    console.error(error);
  }
}


//resend-otp
// Set the countdown timer to 60 seconds
let countdown = 60;

// Function to start the countdown timer
function startCountdown() {
  const timerElement = document.getElementById('countdown-timer');
  timerElement.textContent = `Resend OTP in ${countdown} seconds`;
  countdown--;
  if (countdown < 0) {
    clearInterval(timer);
    timerElement.textContent = '';
    const resendButton = document.getElementById('resend-otp');
    resendButton.disabled = false;
  }
}

// Function to handle the click event of the resend OTP button
async function resendOTP() {
  try {
    const response = await fetch('/api/resend-otp', {
      method: 'POST'
    });
    const data = await response.json();
    console.log(data); // Output: { success: true }
    countdown = 60;
    const resendButton = document.getElementById('resend-otp');
    resendButton.disabled = true;
    const timer = setInterval(startCountdown, 1000);
  } catch (error) {
    console.error(error);
  }
}

// Attach an event listener to the resend OTP button
const resendButton = document.getElementById('resend-otp');
resendButton.addEventListener('click', resendOTP);



<%- include('../layouts/userLayout/userHeader') %>

</head>

<body>
  <!--::header part start::-->
  <%- include('../layouts/userLayout/userNavBarLogin') %>
  <!-- Header part end-->


  <!--================Home Banner Area =================-->
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Shopping Cart</h2>
              <p></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
              </tr>
            </thead>
            <tbody>

              <% if(product.length > 0){ %>
              <%for(let i=0; i < product.length;i++ ){%>
              <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img src="/images/<%= product[i].items[0].img1[0] %>" alt="" width="75px"/>
                    </div>
                    <div class="media-body">
                      <p><%= product[i].items[0].productName %></p>  
                    </div>
                  </div>
                </td>
                <td>
                  <h5>Rs. <%= product[i].items[0].price %></h5>
                </td>
                <td>
                  <div class="product_count">
                    <span class="input-number-decrement" onclick="updateQty('<%= product[i]._id %>','<%= product[i].product %>',-1)"> <i class="ti-angle-down"></i></span>
                    <input class="input-number" type="text" value="<%= product[i].quantity %>" min="0" max="<%= product[i].items[0].stock %>">
                    <span class="input-number-increment" onclick="updateQty('<%= product[i]._id %>','<%= product[i].product %>',1)"> <i class="ti-angle-up"></i></span>
                  </div> 
                </td>
                <td>
                  <h5>Rs. <%= productTotal[i].total %></h5> 
                </td>
                <td>
                  <button type="button" value="" id='registerButton'class="btn_3" onclick="removeItemCart('<%= product[i]._id %>','<%= product[i]._id %>','<%= i %>')">Remove</button>
                </td>
              </tr>
              <%}}else{%>

                <p>No Products added to the cart</p>

                <%}%>


              <!-- <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img src="img/product/single-product/cart-1.jpg" alt="" />
                    </div>
                    <div class="media-body">
                      <p>Minimalistic shop for multipurpose use</p>
                    </div>
                  </div>
                </td>
                <td>
                  <h5>$360.00</h5>
                </td>
                <td>
                  <div class="product_count">
                     <input type="text" value="1" min="0" max="10" title="Quantity:"
                      class="input-text qty input-number" />
                    <button
                      class="increase input-number-increment items-count" type="button">
                      <i class="ti-angle-up"></i>
                    </button>
                    <button
                      class="reduced input-number-decrement items-count" type="button">
                      <i class="ti-angle-down"></i>
                    </button> -->
                    <!-- <span class="input-number-decrement"> <i class="ti-angle-down"></i></span>
                    <input class="input-number" type="text" value="1" min="0" max="10">
                    <span class="input-number-increment"> <i class="ti-angle-up"></i></span>
                  </div>
                </td>
                <td>
                  <h5>$720.00</h5>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img src="img/product/single-product/cart-1.jpg" alt="" />
                    </div>
                    <div class="media-body">
                      <p>Minimalistic shop for multipurpose use</p>
                    </div>
                  </div>
                </td>
                <td>
                  <h5>$360.00</h5>
                </td>
                <td>
                  <div class="product_count">
                    <span class="input-number-decrement"> <i class="ti-angle-down"></i></span>
                    <input class="input-number" type="text" value="1" min="0" max="10">
                    <span class="input-number-increment"> <i class="ti-angle-up"></i></span>
                  </div>
                </td>
                <td>
                  <h5>$720.00</h5>
                </td>
              </tr> --> 


              <tr class="bottom_button">
                <!-- <td>
                  <a class="btn_1" href="#">Update Cart</a>
                </td> -->
                <td></td>
                <td></td>
                <td>
                  <!-- <div class="cupon_text float-right">
                    <a class="btn_1" href="#">Close Coupon</a>
                  </div> -->
                </td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Total</h5>
                </td>
                <td>
                  <h5>Rs. <%= total[0].total %></h5>
                </td>
              </tr>
              <!-- <tr class="shipping_area">
                <td></td>
                <td></td>
                <td>
                  <h5>Shipping</h5>
                </td>
                <td>
                  <div class="shipping_box">
                    <ul class="list">
                      <li>
                        <a href="#">Flat Rate: $5.00</a>
                      </li>
                      <li>
                        <a href="#">Free Shipping</a>
                      </li>
                      <li>
                        <a href="#">Flat Rate: $10.00</a>
                      </li>
                      <li class="active">
                        <a href="#">Local Delivery: $2.00</a>
                      </li>
                    </ul>
                    <h6>
                      Calculate Shipping
                      <i class="fa fa-caret-down" aria-hidden="true"></i>
                    </h6>
                    <select class="shipping_select">
                      <option value="1">Bangladesh</option>
                      <option value="2">India</option>
                      <option value="4">Pakistan</option>
                    </select>
                    <select class="shipping_select section_bg">
                      <option value="1">Select a State</option>
                      <option value="2">Select a State</option>
                      <option value="4">Select a State</option>
                    </select> -->
                    <!-- <input type="text" placeholder="Postcode/Zipcode" /> -->
                    <a class="btn_1" href="#">Update Details</a>
                  </div>
                </td>
              </tr> 
            </tbody>
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="/">Continue Shopping</a>
            <a class="btn_1 checkout_btn_1" href='/checkout'>Proceed to checkout</a>
          </div>
        </div> 
      </div>
  </section>
  <!--================End Cart Area =================-->

  <!--::footer_part start::-->
  <footer class="footer_part">
    <div class="container">
      <div class="row justify-content-around">
        <div class="col-sm-6 col-lg-2">
          <div class="single_footer_part">
            <h4>Top Products</h4>
            <ul class="list-unstyled">
              <li><a href="">Managed Website</a></li>
              <li><a href="">Manage Reputation</a></li>
              <li><a href="">Power Tools</a></li>
              <li><a href="">Marketing Service</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-6 col-lg-2">
          <div class="single_footer_part">
            <h4>Quick Links</h4>
            <ul class="list-unstyled">
              <li><a href="">Jobs</a></li>
              <li><a href="">Brand Assets</a></li>
              <li><a href="">Investor Relations</a></li>
              <li><a href="">Terms of Service</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-6 col-lg-2">
          <div class="single_footer_part">
            <h4>Features</h4>
            <ul class="list-unstyled">
              <li><a href="">Jobs</a></li>
              <li><a href="">Brand Assets</a></li>
              <li><a href="">Investor Relations</a></li>
              <li><a href="">Terms of Service</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-6 col-lg-2">
          <div class="single_footer_part">
            <h4>Resources</h4>
            <ul class="list-unstyled">
              <li><a href="">Guides</a></li>
              <li><a href="">Research</a></li>
              <li><a href="">Experts</a></li>
              <li><a href="">Agencies</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4">
          <div class="single_footer_part">
            <h4>Newsletter</h4>
            <p>Heaven fruitful doesn't over lesser in days. Appear creeping
            </p>
            <div id="mc_embed_signup">
              <form target="_blank"
                action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                method="get" class="subscribe_form relative mail_part">
                <input type="email" name="email" id="newsletter-form-email" placeholder="Email Address"
                  class="placeholder hide-on-focus" onfocus="this.placeholder = ''"
                  onblur="this.placeholder = ' Email Address '">
                <button type="submit" name="submit" id="newsletter-submit"
                  class="email_icon newsletter-submit button-contactForm">subscribe</button>
                <div class="mt-10 info"></div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="copyright_part">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <div class="copyright_text">
              <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="ti-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></P>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="footer_icon social_icon">
              <ul class="list-unstyled">
                <li><a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a></li>
                <li><a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                <li><a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a></li>
                <li><a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!--::footer_part end::-->

  <%- include('../layouts/userLayout/userFooter') %> 

  <script>
    function updateQty(cartId,productId,count){
      console.log('cart:',cartId,'product:',productId,'count:',count);
      fetch('/update_cart_quantity',{
        
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body: JSON.stringify({
          cartId:cartId,
          productId:productId,
          count:count
        })
      })
      .then((res)=>res.json())
      .then((res)=>window.location.reload())
      .catch(error => console.error(error))
    }
  </script>

  <script>
    function removeItemCart(cartId, productId, index){
      console.log(cartId, 'cartId', productId,'productID',index,'index');
      fetch('/remove_product_cart',{
        
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body: JSON.stringify({

          cartId:cartId, 
          productId:productId,
          index:index

        })
      })
      .then((res)=>res.json())
      .then((res)=>window.location.reload()) 
      .catch(error=>console.error(error))
    }
  </script>


function block(data) {
  fetch("/admin/blockuser", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      id: data
    })
  })
    .then((res) => res.json())
    .then((res) => {
      // Update button text and color
      const button = document.querySelector(`button[data-id="${data}"]`);
      if (button) {
        if (res === "success") {
          const isBlocked = button.classList.contains("btn-danger");
          button.classList.toggle("btn-success", isBlocked);
          button.classList.toggle("btn-danger", !isBlocked);
          button.textContent = isBlocked ? "Unblock" : "Block";
        }
      }
    })
    .catch(error => console.error(error))
}

<button type="button" class="btn <%= users[i].block ? "btn-success" : "btn-danger" %>"
  onclick="block('<%= users[i]._id %>')" data-id="<%= users[i]._id %>">
  <%= users[i].block ? "Unblock" : "Block" %>
</button>



 <!-- <td data-title="category">
                            <% const category = categories.find(category => category._id.toString() === products[i].category.toString()) %>
                            <%= category ? category.name : 'N/A' %>
                         </td>                     -->


                         <!-- <% for(let i=0;i<categories.length;i++){ %>
                            <% if(categories[i]._id.toString() === product.category.toString()) { %>
                              <option value="<%= categories[i]._id%>" selected><%= categories[i].name %></option>
                            <% } else { %>
                              <option value="<%= categories[i]._id%>"><%= categories[i].name %></option>
                            <% } %>
                          <% } %>  -->



                          const updateQuantity = async (cartId, productId, quantity, index) => {
                            try {
                              const response = await fetch(`/Cart/updateQuantity`, {
                                method: "PUT",
                                headers: {
                                  "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                  cartId,
                                  productId,
                                  quantity
                                })
                              });
                          
                              const data = await response.json();
                          
                              if (data.status === "success") {
                          
                                // Update UI with new quantity and total price values
                                const inputField = document.querySelectorAll(`#quantityInput${index}`);
                                inputField[0].value = data.data.quantity;
                                const totalField = document.querySelectorAll(`#totalPrice${index}`);
                                totalField[0].textContent = `Rs. ${data.data.totalPrice}`;
                          
                                const totalPriceElem = document.getElementById("total-cart-price");
                                let totalPrice = parseInt(totalPriceElem.innerText.split(".")[1]);
                          
                                // Compute updated total price value
                                if (totalPrice > 0) {
                                  if (quantity == 1) {
                                    totalPrice += parseInt(data.data.unitPrice);
                                  } else {
                                    totalPrice -= parseInt(data.data.unitPrice);
                                  }
                          
                                  // Set the new total price
                                  totalPriceElem.textContent = `Rs. ${totalPrice}.00`;
                                }
                              }
                            } catch (error) {
                              console.log(error.message);
                            }
                          };

                          
               <tr>
                 <td class="product-col">
                   <!-- Product information here -->
                 </td>
                 <td class="price-col">Rs. <%= item.items[0].price %></td>
                 <td class="quantity-col">
                   <div class="cart-product-quantity">
                     <div class="input-group input-spinner">
                       <div class="input-group-prepend">
                         <!-- Button for reducing quantity -->
                         <button style="min-width: 26px" class="btn btn-decrement btn-spinner" type="button"
                           onclick='updateQuantity("<%= item._id %>","<%= item.product %>", <%= item.quantity > 1 ? -1 : 0 %>, <%= index %>)'>
                           <i class="icon-minus"></i>
                         </button>
                       </div>
                       <!-- Input field for quantity -->
                       <input id="quantityInput<%= index %>" class="form-control" type="text" value="<%= item.quantity %>" min="1"
                         max="<%= item.items[0].noOfStocks %>" style="text-align: center;">
                       <div class="input-group-append">
                         <!-- Button for increasing quantity -->
                         <button style="min-width: 26px" class="btn btn-increment btn-spinner" type="button"
                           onclick='updateQuantity("<%= item._id %>","<%= item.product %>", 1, <%= index %>)'>
                           <i class="icon-plus"></i>
                         </button>
                       </div>
                     </div>
                   </div>
                 </td>
                 <% if (productTotalPrice && productTotalPrice.length > 0) { %>
                 <!-- Show the individual product's total price here -->
                 <td class="total-col" id="totalPrice<%= index %>">Rs. <%=productTotalPrice[index].total%></td>
                 <% } %>
                 <td class="remove-col">
                   <!-- Button for removing product from cart -->
                 </td>
               </tr>
                          

    <!-- Sort By -->
<a href="/products/sort/name/asc">Sort by Name A-Z</a>
<a href="/products/sort/name/desc">Sort by Name Z-A</a>
<a href="/products/sort/price/asc">Sort by Price Low to High</a>
<a href="/products/sort/price/desc">Sort by Price High to Low</a>

<!-- Filter By Category -->
<select name="category" id="category">
  <option value="">All Categories</option>
  <% categories.forEach(category => { %>
    <option value="<%= category._id %>"><%= category.name %></option>
  <% }) %>
</select>
<button id="filter-btn">Filter</button>

const sortProducts = async (req, res) => {
  try {
    const key = req.params.key;
    const direction = req.params.direction === 'asc' ? 1 : -1;
    const query = {};
    query[key] = direction;
    const products = await Product.find({ block: false }).sort(query).exec();
    res.render('products', { products });
  } catch (error) {
    console.log(error.message);
  }
};

const filterProducts = async (req, res) => {
  try {
    const categoryId = req.params.category;
    let products = [];
    if (categoryId) {
      products = await Product.find({
        block: false,
        category: categoryId,
      }).exec();
    } else {
      products = await Product.find({ block: false }).exec();
    }
    res.render('products', { products });
  } catch (error) {
    console.log(error.message);
  }
};

const sortLinks = document.querySelectorAll('[href^="/products/sort"]');
const filterBtn = document.getElementById('filter-btn');
const categorySelect = document.getElementById('category');

sortLinks.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const url = e.target.getAttribute('href');
    fetch(url).then(res => window.location.reload());
  });
});

filterBtn.addEventListener('click', () => {
  const categoryId = categorySelect.value;
  const url = categoryId ? `/products/filter/${categoryId}` : '/products';
  fetch(url).then(res => window.location.reload());
});


<div class="collapse show" id="widget-1">
  <div class="widget-body">
    <div class="filter-items filter-items-count">
      <% if (categories.length > 0) { %>
        <% for (let i = 0; i < categories.length; i++) { %>
          <div class="filter-item">
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input category-checkbox" id="cat-<%= categories[i]._id %>-checkbox" 
                value="<%= categories[i]._id %>" 
                <% if (selectedCategories && selectedCategories.includes(categories[i]._id.toString())) { %>checked<% } %> />
              <label class="custom-control-label" for="cat-<%= categories[i]._id %>-checkbox"><%= categories[i].name %></label>
            </div> <!-- End .custom-checkbox -->
          </div>
        <% } %>
      <% } %>
    </div> <!-- End .filter-items -->
  </div> <!-- End .widget-body -->
</div> <!-- End .collapse -->


const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
categoryCheckboxes.forEach((checkbox) => {
  checkbox.addEventListener('click', () => {
    const selectedCategories = [];
    categoryCheckboxes.forEach((c) => {
      if (c.checked) {
        selectedCategories.push(c.value);
      }
    });
    const queryParams = new URLSearchParams(window.location.search);
    queryParams.set('categories', selectedCategories.join(','));
    window.location.search = queryParams.toString();
  });
});


const loadProducts = async (req, res) => {
  try {
    let search = '';
    if (req.query.search) {
      search = req.query.search;
    }

    let page = 1;
    if (req.query.page) {
      page = req.query.page;
    }

    const limit = 6;
    const query = { block: false };
    const categories = await Category.find({ block: false });

    // Filter by selected categories
    const selectedCategories = req.query.categories; // assuming it's an array of category ids
    if (selectedCategories && selectedCategories.length > 0) {
      query.category = { $in: selectedCategories };
    } else {
      query.category = { $nin: await Category.find({ block: true }).distinct('_id') };
    }

    // Apply search
    if (search) {
      query.$or = [
        { name: { $regex: `.*${search}.*`, $options: 'i' } },
      ];
    }

    const products = await Product.find(query)
      .limit(limit * 1)
      .skip((page - 1) * limit)
      .exec();

    const count = await Product.countDocuments(query);

    const user = req.session.userData;

    res.render('products', {
      categories,
      user,
      products,
      totalPages: Math.ceil(count / limit),
      currentPage: page,
      previous: page - 1,
      next: Number(page) + 1,
      limit,
      search,
      selectedCategories,
    });
  } catch (error) {
    console.log(error.message);
  }
};

original one of my checkbox
<div class="collapse show" id="widget-1">
  <div class="widget-body">
    <div class="filter-items filter-items-count">
      <%if(categories.length>0){%>
      <%
        for(let i=0;i<categories.length;i++){%>
     
        <div class="filter-item">
          <div class="custom-control custom-checkbox">
            <input
              type="checkbox"
              class="custom-control-input"
              id="cat-<%= categories[i]._id %>-checkbox"
            />
            <label class="custom-control-label" for="cat-<%=categories[i]._id%>-checkbox"
              > <%= categories[i].name%>                                   
            </label
            >
          </div> 
        <!-- End .custom-checkbox -->                            
        </div>
        <%}                          
      %>
      
      <%}%>
    </div>
    <!-- End .filter-items -->
  </div>
  <!-- End .widget-body -->
</div>



<div class="toolbox-right">
  <div class="toolbox-sort">
    <label for="sortby">Sort by:</label>
    <div class="select-custom">
      <select name="sortby" id="sortby" class="form-control" onchange="this.form.submit()">
        <option value="" disabled selected>Select</option>
        <option value="low_to_high" <% if(sortby === "low_to_high") { %>selected<% } %>>Price: Low to High</option>
        <option value="high_to_low" <% if(sortby === "high_to_low") { %>selected<% } %>>Price: High to Low</option>
      </select>
    </div>
  </div>
  <!-- End .toolbox-sort -->
</div>


category default Page
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item disabled">
      <a
        class="page-link page-link-prev"
        href="#"
        aria-label="Previous"
        tabindex="-1"
        aria-disabled="true"
      >
        <span aria-hidden="true"
          ><i class="icon-long-arrow-left"></i></span
        >Prev
      </a>
    </li>
    <li class="page-item active" aria-current="page">
      <a class="page-link" href="#">1</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="#">2</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="#">3</a>
    </li>
    <li class="page-item-total">of 6</li>
    <li class="page-item">
      <a
        class="page-link page-link-next"
        href="#"
        aria-label="Next"
      >
        Next
        <span aria-hidden="true"
          ><i class="icon-long-arrow-right"></i
        ></span>
      </a>
    </li>
  </ul>
</nav>


categorywise filter page varanulla radio button code
<div>
  <label>
    <input type="radio" name="category" value="clothing">
    Clothing
  </label>
  <label>
    <input type="radio" name="category" value="electronics">
    Electronics
  </label>
  <!-- add more radio buttons for other categories -->
</div>
fetch for radio
document.querySelectorAll('input[name="category"]').forEach((radio) => {
  radio.addEventListener('change', () => {
    const category = document.querySelector('input[name="category"]:checked').value;

    fetch(`/products?category=${category}`)
      .then((response) => response.json())
      .then((products) => {
        const productList = document.getElementById('product-list');
        productList.innerHTML = '';

        products.forEach((product) => {
          productList.innerHTML += `<li>${product.name} - ${product.price}</li>`;
        });
      })
      .catch((error) => console.error(error));
  });
});



<script>
  async function filterProductsByCategory(categoryId) {
    try {
      const response = await fetch(`/filterproducts?category=${categoryId}`);

      
      const products = await response.json();
      const productList = document.getElementById('productList');
      let productHtml = '';       
      productHtml += `      
            ${products[0].name}                 
        `; 

      productList.innerHTML = productHtml;
    } catch (error) {
      console.error(error);
    }
  }
</script>

ejs fileil kanikkan
<ul id="product-list">
  <% products.forEach(function(product) { %>
    <li><%= product.name %> - <%= product.price %></li>
  <% }) %>
</ul>



<div class="products mb-3">
  <div class="row justify-content-center">
    <% if (products.length > 0) { %>
      <% for (let i = 0; i < products.length; i++) { %>
        <div class="col-6 col-md-4 col-lg-4">
          <div class="product product-7 text-center">
            <figure class="product-media">
              <a href="/singleproduct?id=<%= products[i]._id %>">
                <img src="/productImages/<%= products[i].image[0] %>" alt="Product image" class="product-image" style="width: 277px;height: 277px;">
              </a>

              <div class="product-action-vertical" id="wishlist-container">
                <a href="#" class="btn-product-icon btn-wishlist btn-expandable" <% if (!user) { %> onclick="window.location.href='/login' " <% } else { %> onclick="addToWishlist('<%= products[i]._id %>')" <% } %>>
                  <span>add to wishlist</span>
                </a>
              </div>

              <div class="product-action">
                <a href="#" class="btn-product btn-cart" <% if (!user) { %> onclick="window.location.href='/login' " <% } else { %> onclick="addToCart('<%= products[i]._id %>')" <% } %>>
                  <span>add to cart</span>
                </a>
              </div>
            </figure>

            <div class="product-body">
              <div class="product-cat">
                <a href="#"></a>
              </div>

              <h3 class="product-title">
                <a href="/singleproduct?id=<%= products[i]._id %>"><%= products[i].name %></a>
              </h3>

              <div class="product-price">Rs.<%= products[i].price %></div>

              <div class="product-nav product-nav-thumbs">
                <% let images = products[i].image.slice(0,3); %>
                <% if (images.length < 3) { %>
                  <% while (images.length < 3) { %>
                    <% images.push(products[i].image[0]); %>
                  <% } %>
                <% } %>
                <% images.forEach(function(image, index){ %>
                  <a href="#" class="<%= index === 0 ? 'active' : '' %>">
                    <img src="/productImages/<%= image %>" alt="product desc" style="width: 40px; height: 40px;">
                  </a>
                <% }); %>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    <% } else { %>
      <div class="col-12">
        <p>No products found.</p>
      </div>
    <% } %>
  </div>
</div>



const productList = document.getElementById('productList');
          let productHtml = '';
         

          productHtml += `                    
            
                ${products[0].name}
                    
            `;        
   
          productList.innerHTML = productHtml;


          function updateQuantity(cartId, productId, count) {
            // Send a request to the server to add quantity to the cart
            fetch('/addquantity', {
              method:'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                cartId: cartId,
                productId: productId,
                count: count
              })
            })
            .then((res) => res.json())
            .then((cart) => {
              // Update the quantity in the UI
              const productQuantity = document.querySelector(`[data-product-id="${productId}"]`);
              if (productQuantity) {
                productQuantity.textContent = cart.products.find(product => product.productId == productId).quantity;
              }
            })
            .catch(error => console.error(error))
          }
          
          <nav aria-label="Page navigation" id="pagination">
            <ul class="pagination justify-content-center">
              <li class="page-item">
                <% if (currentPage > 1) { %>
                  <a class="page-link page-link-prev"
                  href="/products/filter?category=<%=categoryId%>&page=<%= previous %>&search=<%= search %>"
                  aria-label="Previous"
                  tabindex="-1"
                  aria-disabled="true">
                  <span aria-hidden="true"
                  ><i class="icon-long-arrow-left"></i></span
                >Prev</a>
                <% } else { %>
                  <span class="page-link page-link-next" aria-label="Previous" aria-hidden="true">
                    <i class="icon-long-arrow-left"></i>Prev</span>
                <% } %>                      
          
              </li>
              <%for(let i=1;i<=totalPages;i++){%>
                <%if(i==currentPage){%>
                  <li class="page-item active page-link" aria-current="page"><%=i%></li>
                <%}else{%>
                  <li class="page-item active" aria-current="page">
                    <a class="page-link" href="?category=<%=categoryId%>&page=<%=i%>&search=<%=search%>"><%= i %></a>
                  </li> 
                <%}%>                                   
              <%}%>
          
              <li class="page-item"> 
                <% if (currentPage < totalPages) { %>
                  <a class="page-link page-link-next"
                  href="/products/filter?category=<%=categoryId%>&page=<%= next %>&search=<%= search %>"
                  aria-label="Next">Next
                  <span aria-hidden="true"
                  ><i class="icon-long-arrow-right"></i>
                  </span>
                </a>
                <% } else { %>
                  <span class="page-link page-link-next" aria-label="Next" aria-hidden="true">Next 
                  <i class="icon-long-arrow-right"></i>
                  </span>
                <% } %>                    
              </li>
            </ul>
          </nav>
          

          const filterProducts = async(req,res)=>{
            let search = '';
              if(req.query.search){
                search = req.query.search; 
              }    
            let page = 1;
              if(req.query.page){
                page = req.query.page;
              } 
            const limit = 3;
            try {     
              const categoryId = req.query.category;
          
              // Get all Category ids
              const categories= await Category.find({block:false}, '_id');
          
              // Create an array for storing product counts for each category
              const categoryCounts = [];
              for (category of categories) {
                const count = await Product.find({
                  category: category._id,
                  $or:[
                    {name:{$regex:'.*'+search+'.*',$options:'i'}},
                  ],
                }).countDocuments();
                
                categoryCounts.push(count);
              }
          
              // Find related products excluding the current product
              const relatedProducts = await Product.find({category:categoryId, _id: {$ne: req.query.id}});
          
              //paginate the category products
              const products = await Product.find({
                category:categoryId,
                $or:[
                  {name:{$regex:'.*'+search+'.*',$options:'i'}},
                ],
              }).limit(limit * 1).skip((page-1)*limit).exec();   
              
              const count = await Product.find({
                category:categoryId,
                $or:[
                  {name:{$regex:'.*'+search+'.*',$options:'i'}},
                ],
              }).countDocuments();  
          
              const user= req.session.userData;
              const categoryScroll = await Category.findOne({_id:categoryId});
          
              res.render('filteredproducts', {
                products: products,
                categories: categories, // All categories
                categoryCounts: categoryCounts,  // An array of product counts for each category
                user: user,
                totalPages: Math.ceil(count/limit),
                currentPage: page,
                previous: page-1,
                next: Number(page)+1,
                limit: limit,
                search: search
              });
            } catch (error) {
              console.log(error.message);
            }
          }
          
          <nav aria-label="Page navigation" id="pagination">
            <ul class="pagination justify-content-center">
              <!-- Prev button -->
              <li class="page-item">
                <% if (currentPage > 1) { %>
                <a class="page-link page-link-prev"
                  href="/products/filter?category=<%=categoryId%>&page=<%= previous %>&search=<%= search %>"
                  aria-label="Previous"
                  tabindex="-1"
                  aria-disabled="true">
                  <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                </a>
                <% } else { %>
                <span class="page-link page-link-next" aria-label="Previous" aria-hidden="true"><i class="icon-long-arrow-left"></i>Prev</span>
                <% } %>  
          
              </li>
              
              <!-- Numbered pages loop -->
              <% for(let i=1; i<=totalPages; i++) { %>
                <% if(i == currentPage) { %>
                <li class="page-item active page-link" aria-current="page"><%=i%></li>
                <% } else { %>
                <li class="page-item active" aria-current="page">
                  <a class="page-link" href="?category=<%=categoryId%>&page=<%=i%>&search=<%=search%>"><%= i %></a>
                </li> 
                <% } %>                                   
              <% } %>
          
              <!-- Next button -->
              <li class="page-item"> 
                <% if (currentPage < totalPages) { %>
                <a class="page-link page-link-next"
                  href="/products/filter?category=<%=categoryId%>&page=<%= next %>&search=<%= search %>"
                  aria-label="Next">Next
                  <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                </a>
                <% } else { %>
                <span class="page-link page-link-next" aria-label="Next" aria-hidden="true">Next <i class="icon-long-arrow-right"></i></span>
                <% } %>                    
              </li>
            </ul>
          </nav>
          


          place order code based on my orderschema
          const createOrder = async (req, res) => {
            try {
              const cart = await Cart.findOne({ userId: req.session.userData._id }).populate('products.product');
              const products = cart.products.map((item) => ({
                productId: item.product._id,
                quantity: item.quantity,
                price: item.product.price,
              }));
          
              const total = cart.products.reduce((acc, item) => {
                return acc + item.product.price * item.quantity;
              }, 0);
          
              const newOrder = new Order({
                userId: req.session.userData._id,
                products: products,
                totalPrice: total,
                address: req.body.address,
                payment: req.body.payment,
                createdAt: moment().format('MMMM Do YYYY, h:mm:ss a'),
              });
          
              const createOrder = await newOrder.save();
          
              if (createOrder) {
                // Update product stock
                products.forEach(async (product) => {
                  await Product.updateOne(
                    { _id: product.productId },
                    { $inc: { stock: -product.quantity } }
                  );
                });
          
                // Delete cart
                const deleteCart = await Cart.findOneAndDelete({ userId: req.session.userData._id });
                if (deleteCart) {
                  console.log('Cart Deleted');
                }
          
                if (req.body.payment === 'COD') {
                  res.redirect(`/order_confirmation?id=${createOrder._id}`);
                } else {
                  res.status(200).json({ redirectUrl: `/order_confirmation?id=${createOrder._id}` });
                }
              }
            } catch (error) {
              console.log(error.message);
            }
          };
          

sortedproducts page only div section that i had before
<%-include('../layouts/header')%>

    <div class="page-wrapper">
      

      <main class="main">
        
       

        <div class="page-content">
          <div class="container">
            <div class="row">
              <div class="col-lg-9">
                

                <div class="products mb-3" id="productList">
                  <div class="row justify-content-center">
                    <% if(products.length>0){%>
                    <% for(let i=0;i<products.length;i++){%>
                      
                    <div class="col-6 col-md-4 col-lg-4">
                      <div class="product product-7 text-center">
                        <figure class="product-media">
                          
                          <a href="/singleproduct?id=<%=products[i]._id%>">
                            <img
                              src="/productImages/<%= products[i].image[0]%>"
                              alt="Product image"
                              class="product-image"
                              style="width: 277px;height: 277px;"
                            />
                          </a>

                          <div class="product-action-vertical" id="wishlist-container">
                            <a
                              href="#"
                              class="btn-product-icon btn-wishlist btn-expandable"
                              <% if(!user) {%>
                                onclick="window.location.href='/login' "
                              <%}else{%>
                                  onclick="addToWishlist('<%=products[i]._id%>') "
                                <%}%>

                              ><span>add to wishlist</span></a
                            >
                          </div>
                          <!-- End .product-action-vertical -->

                          <div class="product-action">
                           
                            <a href="#" class="btn-product btn-cart"
                              <% if (!user) { %>
                                onclick="window.location.href='/login' "
                                <% } else { %>
                                  onclick="addToCart('<%=products[i]._id%>') "
                               <% } %>
                              >
                              <span>add to cart</span>
                            </a>
                          </div>
                          <!-- End .product-action -->
                        </figure>
                        <!-- End .product-media -->

                        <div class="product-body">
                          <div class="product-cat">
                            <a href="#"></a>
                          </div>
                          <!-- End .product-cat -->
                          <h3 class="product-title">
                            <a href="/singleproduct?id=<%=products[i]._id%>"
                              ><%= products[i].name %></a
                            >
                          </h3>
                          <!-- End .product-title -->
                          <div class="product-price">Rs.<%= products[i].price%></div>
                          <!-- End .product-price -->                          

                          <div class="product-nav product-nav-thumbs">

                            <% let images = products[i].image.slice(0,3); %>
                            <% if(images.length < 3) {
                                while(images.length < 3){
                                    images.push(products[i].image[0]);
                                }
                              }
                            %>
                            <% images.forEach(function(image, index){ %>
                              <a href="#" class="active">
                                <img src="/productImages/<%= image %>" alt="product desc" 
                                style="width: 40px; height: 40px;"
                                />
                              </a>
                            <% }); %>
                           
                          </div>                        
                          <!-- End .product-nav -->
                        </div>                        
                        <!-- End .product-body -->
                      </div>
                      <!-- End .product -->
                    </div>
                    <!-- End .col-sm-6 col-lg-4 -->
                    <%}}%>
                  </div>
                  <!-- End .row -->
                </div>
                <nav aria-label="Page navigation" id="pagination">
                  <ul class="pagination justify-content-center">
                    <li class="page-item">
                      <% if (currentPage > 1) { %>
                        <a class="page-link page-link-prev"
                        href="/sort?sortBy=<%= sortBy %>&page=<%= previous %>&search=<%= search %>"
                        aria-label="Previous"
                        tabindex="-1"
                        aria-disabled="true">
                        <span aria-hidden="true"
                        ><i class="icon-long-arrow-left"></i></span
                      >Prev</a>
                      <% } else { %>
                        <span class="page-link page-link-next" aria-label="Previous" aria-hidden="true">
                          <i class="icon-long-arrow-left"></i>Prev</span>
                      <% } %>                     
                     
                    </li>
                    <%for(let i=1;i<=totalPages;i++){%>
                      <%if(i==currentPage){%>
                        <li class="page-item active page-link" aria-current="page"><%=i%></li>
                        <%}else{%>
                          <li class="page-item active" aria-current="page">
                            <a class="page-link" href="?sortBy=<%= sortBy %>&page=<%=i%>&search=<%=search%>"><%= i %></a>

                          </li> 
                          <%}%>                                             
                    <%}%>                    
                  
                    <li class="page-item"> 
                      <% if (currentPage < totalPages) { %>
                        <a class="page-link page-link-next"
                        href="/sort?sortBy=<%= sortBy %>&page=<%= next %>&search=<%= search %>"
                        aria-label="Next">Next
                        <span aria-hidden="true"
                        ><i class="icon-long-arrow-right"></i>
                        </span>
                      </a>
                      <% } else { %>
                        <span class="page-link page-link-next" aria-label="Next" aria-hidden="true">Next 
                          <i class="icon-long-arrow-right"></i>
                          </span>
                      <% } %>                    
                     
                    </li>
                  </ul>
                </nav>

              </div>
              <!-- End .col-lg-9 -->             
              
            </div>
            <!-- End .row -->
          </div>
          <!-- End .container -->
        </div>
        <!-- End .page-content -->
      </main>
      <!-- End .main -->
      
      <!-- End .footer -->
    </div>
    <!-- End .page-wrapper -->
   
    
    
    

    

    <script>
      const addToWishlist = async(productId)=>{
        const response = await fetch('/addwishlist',{
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({productId: productId})
        }).catch(error=>console.error(error))
        if(response.ok){
          const data = await response.json();
          alert("Product added to wishlist");    
          const wishlistContainer = document.getElementById('wishlist-container');
          const itemElement = document.createElement("div");
          wishlistContainer.appendChild(itemElement);
        }
        else{
          alert("Error adding product to wishlist");
        }
      }         
    </script>
    
   
    
    <script>
      const addToCart = async (productId) => {
      try {
        const response = await fetch('/addtocart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId })
        });

      const data = await response.json();
      if (data.message === 'Product is already present in cart') {  
        alert('Product is already present in cart');
      } else {
      // Update the cart count in the UI
          const cartCountEl = document.getElementById('cart-count');
          cartCountEl.textContent = data.totalQuantity;
          alert('Product added to cart');
        }
      } catch (error) {
        console.error(error);
        alert('Error adding product to cart');
      }
    };
    </script>
    
    <%-include('../layouts/footer')%> 







    <!-- <tr> 
                            <%if(user.wallet > 0){%>                            
                              <td><input type="checkbox" name="wallet" id="wallet-checkbox" onclick="clickWallet('<%=totalPrice[0].total%>')"> Wallet Balance :</td>
                              <input type="hidden" id="wallet-amount" name="walletAmount" value="<%=user.wallet%>">
                              <td>Rs. <%=user.wallet%></td>    
                            <%}%>                        
                          </tr> --> keep this safe